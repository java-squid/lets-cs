# 0. 쿠키와 세션을 사용하는 이유
HTTP 프로토콜의 특징이자 약점을 보완하기 위해서 사용한다.

### HTTP 프로토콜 특징
1. 비연결지향 (Connectionless)
    - HTTP는 클라이언트가 요청을 서버에 보내고, 서버는 클라이언트에게 적절한 응답을 주고 연결을 끊는 특성이 있다.
        - HTTP 1.1 버전에서는 커넥션을 계속 유지하고 요청에 재활용하는 기능이 추가되었다. HTTP Header에 keep-alive 옵션을 주어 커넥션을 재활용한다. HTTP 1.1 버전에서는 디폴트 옵션이다.
    - HTTP 가 TCP 위에서 구현되었기 때문에(TCP는 연결지향, UDP는 비연결지향) HTTP는 연결지향적이라고 주장하는 사람들이 있어 논란이 있지만, 아직 네트워크 관점에서 keep-alive는 옵션으로 두고 있고, 서버 측에서 비연결 지향적인 특성으로 커넥션 관리에 대한 비용을 줄이는 것을 명확한 장점으로 보기 때문에 HTTP의 특징이라 할 수 있다. 
2. 상태없음 (Stateless)
    - 커넥션을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보는 유지하지 않는 특성이 있다.

### 이에 대한 문제점
비연결지향이라는 특성때문에 서버 측에선 통신 할 때마다 새로운 커넥션을 만들어야하고, 클라이언트 측에선 상태를 유지(예: 인증에 사용되는 상태 등)하기 위해 통신 할 때마다 어떤 절차를 가져야하는 단점이 생긴다. 

쿠키와 세션은 이러한 HTTP 특성을 보완하기 위해 사용되고 있다.


# 1. cookie
HTTP 쿠키(웹 쿠키, 인터넷 쿠키, 브라우저 쿠키)는 웹 사이트를 탐색하는 동안 웹 브라우저가 사용자의 컴퓨터에 저장하는 작은 데이터 조각이다. 쿠키는 웹 사이트가 상태 정보(예: 온라인 상점의 장바구니에 추가된 항목)를 기억하거나 사용자의 브라우징 활동(특정 버튼 클릭, 로그인 또는 과거에 방문한 페이지 기록 포함)을 기록하는 신뢰할 수 있는 메커니즘으로 설계되었다.
또한 사용자가 이전에 양식 필드에 입력한 이름, 주소, 비밀번호 및 결제 카드 번호와 같은 정보를 기억하는데 사용할 수 있다.

### 쿠키의 특징
- 브라우저는 사용자의 컴퓨터에 키와 값(key, value)이 들어있는 작은 데이터 파일을 저장한다. 이게 쿠키다.
- 서버에서 HTTP 응답 헤더에 Set-Cookie 속성을 이용하여 클라이언트에 쿠키를 제공한다.
- 이름, 값, 만료날짜/시간(쿠키 저장기간), 경로 정보 등이 들어있다.
- 쿠키는 클라이언트의 상태 정보를 로컬에 저장했다가 서버에 요청을 보낼 때 참조한다.
- 서버 측에서 만료날짜/시간을 지정하여 정해진 시간 동안만 상태 정보를 유지할 수 있도록 한다.

### 세션 쿠키(session coookie)와 지속 쿠키(persistent cookie)
쿠키는 세션 쿠키와 지속 쿠키로 나뉜다.

만료날짜/시간을 지정하지 않으면 항상 유지하라는 것으로 판단하고 지속 쿠키에 저장되고, 만료날짜/시간을 지정하면 세션 쿠키로 저장된다. 지속 쿠키는 사용자 컴퓨터에 파일로 저장되므로 브라우저가 종료되어도 쿠키는 남아있게 되고, 세션 쿠키는 브라우저 메모리에 저장되므로 브라우저가 종료되면 쿠키는 사라지게 된다. 

참고로, 세션 쿠키는 보안이 안전한 브라우저(예: 구글 크롬 등)의 메모리에 저장되기 때문에 보안에 유리하지만, 파일로 저장되는 지속 쿠키의 경우 비교적 보안에 취약하다.

### 쿠키를 발급받아 사용하는 과정
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbetTb6%2FbtqxVesqYq0%2FsUO2b5dpKqVuR261lNZBKk%2Fimg.png)

쿠키는 사용자가 별도로 요청하지 않아도 브라우저에서 서버에 요청 시에 Request 헤더에 쿠키 값을 넣어 요청한다. (=> 자동으로) 그렇다고 비효율적으로 많은 쿠키들을 모든 요청에 넣는 식으로 동작하지 않는다. 도메인 설정을 통해 지정한 도메인으로 요청 할 때만 쿠키를 넣도록 설정 할 수 있다.

### 쿠키 사용 사례
- 자동로그인
- 팝업창 "오늘 더 이상 이 창을 보지 않음" 체크
- 쇼핑몰의 장바구니

### 쿠키의 한계
- 클라이언트에 최대 300개 까지 쿠키를 저장 할 수 있다.
- 서버 도메인 하나 당 최대 20개의 쿠키를 저장 할 수 있다.
- 하나의 쿠키 값은 최대 4KB 까지 저장 할 수 있다.


# 2. session
일정 시간동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 일정하게 유지시키는 기술이다. 여기서 일정 시간은 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말한다. 즉, 방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고 그 것을 세션이라고 한다.

세션은 쿠키를 기반으로 하고 있지만, 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 세션은 서버 측에서 관리합니다. 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증 상태를 유지합니다. 물론 접속 시간에 제한을 두어 일정 시간 응답이 없다면 세션을 끊도록 설정이 가능합니다.

사용자에 대한 정보를 서버에 저장하기 때문에 쿠키보다 보안에 좋지만, 사용자가 많아질수록 서버 메모리를 많이 차지하게 됩니다. 즉, 동접자 수가 많은 웹 사이트인 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 됩니다.

### 세션의 특징
- 각 클라이언트에게 고유 ID를 부여
- 세션 ID로 클라이언트를 구분해서 클라이언트의 요구에 맞는 서비스를 제공
- 보안 면에서 쿠키보다 우수
- 사용자가 많아질수록 서버 메모리를 많이 차지하게 됨

### 세션을 발급받아 사용하는 과정
![](https://miro.medium.com/max/1400/1*Hg1gUTXN5E3Nrku0jWCRow.png)
1. 사용자가 로그인에 성공하면 서버는 사용자에 대한 세션을 생성하고, 세션 ID를 응답을 통해 발급해준다. 
(브라우저 단에서 관리 될 수 있도록 쿠키로 발급하는 게 일반적인 구조)
2. 브라우저는 발급 받은 쿠키(세션 아이디가 담김)를 저장한다. (ex. JSESSIONID)
3. 브라우저는 다시 서버에 요청할 때, 세션 아이디를 서버에 전달하여(브라우저가 자동으로 전달) 상태 정보를 서버가 활용 할 수 있도록 해준다.
4. 서버는 쿠키에 저장된 세션 ID를 메모리에 저장된 세션 정보와 비교하여 사용자의 신원을 확인하는 과정을 거친 후 응답을 보낸다.



### 세션의 사용 사례
- 화면이 이동해도 로그인이 풀리지 않고 로그아웃하기 전까지 유지 (로그인 정보 유지)

# 3. cookie vs session
쿠키와 세션은 비슷한 역할을 하며, 동작원리도 비슷합니다. 그 이유는 세션도 결국 쿠키를 사용하기 때문입니다.

### 사용자 정보 저장 위치
쿠키는 클라이언트(브라우저)에 메모리 또는 파일로 저장되고, 세션은 서버 메모리에 저장된다.

### 보안
쿠키는 브라우저의 메모리 또는 사용자 컴퓨터의 파일로 저장되는데, 특히 파일로 저장되는 경우 개인정보의 탈취 및 변조의 위험이 있고, 요청/응답에서 스나이핑 당할 위험이 있어 보안이 세션에 비해 비교적 취약하다. 반대로 세션은 클라이언트 정보 자체를 서버에서 관리하므로 비교적 안전하다.

### 라이프 사이클
쿠키는 브라우저를 종료하더라도 사용자 컴퓨터에 파일로 저장되어 있을 수 있는 반면에 세션은 만료시간을 정할 수 있지만 브라우저가 종료되면 만료시간에 상관없이 삭제된다.

### 속도
쿠키에는 사용자 정보가 있기 때문에 서버에 요청 시 헤더를 바로 참조하면 되므로 속도면에서 유리하고, 세션은 세션 ID를 서버에서 찾거나 처리하는 작업을 요구하므로 속도가 비교적 느리다.

# 4. 쿠키를 사용해야 할까? 세션을 사용해야 할까?
세션은 쿠키에 비해 보안이 우수하다는 장점이 있지만, 쿠키에 비해 속도가 느리고 또, 서버의 자원(메모리)을 사용하기 때문에 서버 성능 저하의 요인이 될 수 있습니다. 쿠키는 세션보다 속도도 빠르고 저장하는 공간도 브라우저의 메모리나 사용자의 컴퓨터에 저장되기 때문에 이 부분에선 문제가 없지만, 세션에 비해 보안이 취약합니다.

그래서 개인정보와 관련된 부분들은 세션으로 관리하고, 그외 정보가 탈취되도 무관한 부분들은 쿠키로 관리하는 게 맞습니다. 요즘은 "토큰 기반 인증" 방법을 많이 사용하고 있는 추세이기도 합니다. 

### 출처
- https://en.wikipedia.org/wiki/HTTP_cookie
- https://jeong-pro.tistory.com/80
- https://hahahoho5915.tistory.com/32
- https://victorydntmd.tistory.com/34
- https://medium.com/@sherryhsu/session-vs-token-based-authentication-11a6c5ac45e4
- https://interconnection.tistory.com/74