# 트랜잭션이란?
- 데이터를 올바르게 보장하기 위해 고안된 방법
- Database에 한정된 용어가 아님.
  - 트랜잭션 이론 자체는 독립적인 이론이라 볼 수 있음
- 데이터베이스 에서 트랜잭션은 2가지를 보장하기 위해 사용됨.
  1. 믿을수있는 작업 단위를 보장하기 위해 
      - 작업 실패로 안한 정확한 복구를 허용하고,
      - 실패를 하더라도 데이터베이스 시스템이 지속되어 운영되도록 보장해줌.
  2. 커밋 간에 독립적인 환경을 제공해주기 위해.
- 트랜잭션과 관계형 모델은 다른 이론.
  - 그렇지만 데이터를 올바르게 보장하기 위해서, 양쪽 다 필요하는 상호보완적인 관계라 볼 수 있음.

# 트랜잭션은 어떻게 작동하는가?
- 굉장히 복잡한 문제
- 데이터베이스에서 보장해주는 레벨등에 따라 다를 수 있음.
- 스프링에서 `@Transaciotnal` 이 어떻게 작동할까..?
  - 참고 : https://stackoverflow.com/questions/1099025/spring-transactional-what-happens-in-background

# 트랜잭션 기능
1. 동시 실행 제어
    - 데이터에 동시 엑세스하여 부정합이 일어나는 막음.
2. 크래시 복구
    - 예상하지 못한 사태가 일어났어도, 데이터는 올바르게 유지되도록 도와준다.
    - 즉 트랜잭션 도중에.. 데이터 변경이 일어나고 해당 트랜잭션이 정상적으로 닫히지 않은 상태에서 프로그램이 비정상적으로 종료된다면.. 해당 트랜잭션은 롤백되며 데이터에 변화가 없도록 도와준다.

## 부정합이 일어나지 않으려면..?
- 프로세스를 하나씩 차례대로 수행하도록 하면 됨.
- 다만, 위와 같은 방법은 처리 효율이 낮다.
  - 왜? 병렬 처리를 하지 못하기 때문에.
- 수천개의 트랜잭션이 동시에 실행될 수도 있는데, 이 경우 순차적으로 실행하게 하는건 현실적이지 못할듯.

## 그래서 나온 것이 스케쥴 관리
- 트랜잭션의 일련의 과정을 나눔
  - 데이터 읽기, 쓰기로
- 즉 처리 내용에 따라 다른 트랜잭션에 영향을 미치는 것이 있음 (쓰기 작업)
  - 이런 작업이 언제 일어날 것인지, 스케쥴을 잘 짤 수 있다면.. 병렬 환경에서의 트랜잭션 효율이 올라가지 않을까?

## 데이터의 정확성이란?
- 데이터가 올바르게 유지되는 상태
- 개별 트랜잭션을 한 개씩 차례로 실행될 떄 나오는 결과
- 즉 병렬적으로 스케쥴 하에서 실행되는 트랜잭션들을 통해 나온 데이터와, 순차적으로 트랜잭션들이 실행되어 나온 데이터가 같다면, 이 말은 데이터가 **올바르게** 유지되었다고 말할 수 있을 것임.

# 트랜잭션의 특징
- ACID
- 원자성 Atomicity
  - 트랜잭션이 어중간하지 않게 도와준다.
  - 즉 트랜잭션의 결과는 성공 아니면 실패 둘 중 하나밖에 없다.
  - 그리고 실패했을 경우, 롤백 될 수 있음을 의미한다.

- 일관성 Consistensy
  - 트랜잭션을 실시한 전후에, 데이터가 일관성이 있어야한다. (데이터에 부정합이 없어야한다.
  - 일관성이 있는지 없는지는 응용프로그램이 판단한다.

- 격리성 Isolation
 - 동시에 여러개의 트랜잭션이 실행 되었을 때, 트랜잭션 끼리는 서로 영향을 주지 않는다.
 - 1,2,3라는 트랜잭션이 있고, A라는 데이터에 접근되어 실행된다고 할 때, 이러한 트랜잭션이 개밸젹, 순차적으로 실행된 것과 병렬적으로 실행된 것의 결과는 같아야한다.

- 영속성 Durability
  - 일단 커밋이 완료된 트랜잭션은 손상되지 않는다.
  - 즉 트랜잭션이 완료되어, 데이터베이스에 변경이 일어났다면, 이러한 변경은 영구적으로 저장되어야 한다는 의미.

# 더 알아보기
- 스프링에서 사용되는 트랜잭션
  - https://www.baeldung.com/transaction-configuration-with-jpa-and-spring
  - https://www.baeldung.com/spring-transactional-propagation-isolation
- 트랜잭션에서 발생해서는 안되는 상태들..?
  - Inconsistent read, Dirty read, Non Repepeable read...

# 참고
- 관계형 데이터베이스 실전 입문 14장
- https://en.wikipedia.org/wiki/Database_transaction#:~:text=A%20database%20transaction%20symbolizes%20a,any%20change%20in%20a%20database
- https://victorydntmd.tistory.com/129