# L4 로드밸런서 vs L7 로드밸런서 정리

### 로드밸런싱 (부하 분산)

로드밸런싱은 다수의 클라이언트 , 즉 높은 트래픽이 생기는 상황을 대비하는 네트워크 기술의 일종입니다.
중앙처리장치 또는 저장장치와 같은 컴퓨터 리소스를 추가적으로 운용하며 부하의 상황에 작업을 나눔으로써 높은 트래픽이 생기는 상황에도 서버는 안정성을 유지할 수 있습니다.

### 로드밸런서의 문제 해결 방식

- Scale-up : Server의 하드웨어 성능을 높히는 방법
- Scale-out : 여러 대의 Server에 작업을 분산시키는 방법

### L4 로드밸런서

L4 로드밸런서는 Network Layer(TCP/UDP)에서 정의된 정보를 활영하여 클라이언트의 요청을 분산시키는 작업을 진행합니다.정의된 정보는 IP주소,포트,MAC 주소,전송 프로토콜을 활용하여 분산을 결정합니다.

- Round-Robin : 세션을 각 서버에 순차적으로 맺어주는 방식 , 순서를 기반으로 하는 작업이라서 균등한 분산이 보장되지 않을때가 있음
- 가충치 및 비율 할당 방식 : 서버마다 수신 비율을 정하고 그 비율에 맞춰서 분산하는 방식 , 분산된 서버의 성능이 다르다면 가장 좋은 성능을 가진 서버에 할당치를 높히고 낮은 서버는 상대적으로 적은 할당치를 가지게 설계가 가능
- 최소 연결(Least Connection) : 가장 적은 세션을 찾아 해방 서버로 트래픽을 할당하는 방식
- 응답 시간(Response Time) : 가장 빠른 응답 시간을 가지는 서버에 트래픽을 할당하는 방식
- 해시 : 특정 IP 또는 포트를 가지는 사용자는 특정 서버에 할당되도록 하는 방식
- 대역폭 : 서버들과 대역폭을 고려하여 트래픽을 분산

### L7 로드밸런서

L7 로드밸런서는 OSI 모델에서 가장 높은 애플리케이션 계층에서 작동합니다. 포트와 IP를 활용하는 L4의 활용과 함께 컨텐츠 위주의 정보도 분석하여 분산 라우팅에 대한 결정을 내릴 수 있습니다. 아래는 L7 로드밸런서가 분산에 활용하는 정보입니다.

- URL 스위칭 (URL Switching) : 특정 URL의 하위 URL을 특정 서버에 할당하는 방식
  `specific/post` `specific/video` 와 같이 특정 URL을 가진다면 서버가 아닌 별도의 스토리지로 연결
- 컨텍스트 스위칭(Context Switching) : 클라이언트가 요청한 특정 리소스는 특정 서버로 연결되는 방식 , 즉 어떤 리소스를 요청하는지를 판별하여 해당 서버로 갈 수 있도록 설계 가능
- 쿠키 지속성(Persistence with Cookies) : 클라이언트가 가지고 있는 쿠키정보를 바탕으로 클라이언트가 접속했던 서버에 다시 연결하는 방식

### L4 / L7 의 성능 지표

L4 / L7 중 어떤 로드밸런서가 더 좋은 성능을 가지는지는 아래와 같은 지표를 기준으로 판별하게 됩니다.

- 초당 연결수 : TCP 세션 시간당 처리의 수
- 동시 연결수 : 동시에 최대로 세션 연결을 유지할 수 있는 수
- 처리 용량 : UDP 프로토콜에 대한 로드밸런싱 성능 지표 (FWLB에서 중요)
  FWLB : 기존에 한대의 방화벽을 사용할 때 하나의 방화벽에 부하가 집중되면서 품질 저하 & FW 장애와 같은 문제가 발생했고 이런 문제점 때문에 두대의 방화벽을 운용하는 방식이다.

      ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c2fafe75-7689-4a36-97b7-345c407d1939/_2021-06-01__5.44.50.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c2fafe75-7689-4a36-97b7-345c407d1939/_2021-06-01__5.44.50.png)

참고 자료

[https://www.stevenjlee.net/2020/06/30/이해하기-네트워크의-부하분산-로드밸런싱-load-balancing-그/](https://www.stevenjlee.net/2020/06/30/%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EB%B6%80%ED%95%98%EB%B6%84%EC%82%B0-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-load-balancing-%EA%B7%B8/)
